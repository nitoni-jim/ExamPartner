
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ExamPartner â€“ Your trusted partner for exam success</title>
  <meta name="theme-color" content="#111827" />
  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="icons/icon-192.png">
  <link rel="stylesheet" href="styles.css" />

  <style>
    .diagrams { margin: 12px 0; display: flex; flex-wrap: wrap; gap: 12px; }
    .diagram-img { max-width: 100%; height: auto; border: 1px solid rgba(0,0,0,0.12); border-radius: 12px; }

    .filters-row { display: flex; flex-wrap: wrap; gap: 10px; align-items: center; }
    .filters-row label { font-size: 12px; opacity: 0.85; }
    .filters-row select, .filters-row button { height: 38px; }

    /* Admin mini tools */
    .admin-row { display:flex; flex-wrap:wrap; gap:10px; align-items:center; margin-top:10px; }
    .admin-row input { height: 38px; }
    .admin-box { margin-top: 10px; padding-top: 10px; border-top: 1px solid rgba(0,0,0,0.08); }
    .admin-logs {
      width: 100%;
      min-height: 140px;
      max-height: 280px;
      overflow: auto;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 12px;
      white-space: pre;
      padding: 10px;
      border: 1px solid rgba(0,0,0,0.12);
      border-radius: 12px;
      background: rgba(0,0,0,0.02);
    }

    /* âœ… Tiny topbar logout */
    .topbar-right { display:flex; gap:10px; align-items:center; }
    .btn.tiny { height: 30px; padding: 0 10px; font-size: 12px; border-radius: 999px; }
  </style>
</head>
<body>
  <header class="topbar">
    <div class="brand">
      <div class="logo">N</div>
      <div>
        <div class="title">ExamPartner</div>
        <div class="subtitle">Your trusted partner for exam success</div>
      </div>
    </div>

    <div class="topbar-right">
      <div class="chip" id="chipPaid" hidden>PAID</div>

      <!-- âœ… Logout lives here so normal users can always see it when logged in -->
      <button id="btnLogout" class="btn ghost tiny" type="button" hidden>Logout</button>
    </div>
  </header>

  <main class="wrap">
    <section class="card">
      <div class="row space">
        <h2>Account</h2>
      </div>

      <div class="grid2">
        <div class="col" id="devServerCol" hidden>
          <label for="apiBase">Server URL (advanced)</label>
          <input id="apiBase" type="text" placeholder="http://127.0.0.1:8000" />
          <div class="hint">If you are using the hosted app, you can ignore this. For local testing, keep your server running.</div>
        </div>
        <div class="col actions" id="devActionsCol" hidden>
          <button id="btnCheck" class="btn" hidden>Check API</button>
        </div>
      </div>

      <div id="status" class="status" hidden>Not connected.</div>

      <div class="grid2">
        <div class="panel">
          <h3>Login / Register</h3>
          <div class="hint">Use phone or email as your identifier.</div>

          <label for="identifier">Phone or Email</label>
          <input id="identifier" type="text" placeholder="example@email.com or 0803..." />

          <label for="password">Password</label>
          <input id="password" type="password" placeholder="â€¢â€¢â€¢â€¢" />

          <div class="row">
            <button id="btnRegister" class="btn">Register</button>
            <button id="btnLogin" class="btn ghost">Login</button>
          </div>

          <label class="label" id="payEmailLabel" hidden>Receipt email</label>
    <input
         class="input"
         id="payEmailInput"
         type="email"
         placeholder="name@example.com"
         autocomplete="email"
         inputmode="email"
        hidden
       />
  <div class="hint" id="payEmailHint" hidden>
    Paystack requires an email for receipts. 
  </div>


          <div id="authMsg" class="hint"></div>
        </div>

        <div class="panel">
          <div class="row space">
            <h3>Upgrade (Paystack)</h3>

            <!-- âœ… Tiny Admin-only button -->
            <button id="btnAdmin" class="btn ghost" type="button" title="Admin tools" hidden>Admin</button>
          </div>

          <div class="hint" id="upgradeHint" hidden>
            Youâ€™re using the free preview. Upgrade to unlock all questions.

          </div>
           

          <div class="row">
            <button id="btnPay" class="btn">Pay â‚¦1,000</button>
            <button id="btnCheckPaid" class="btn ghost">Refresh Paid Status</button>
          </div>

          <!-- âœ… Admin tools (hidden unless admin key is set in sessionStorage) -->
          <div id="adminTools" class="admin-box" hidden>

            <div class="admin-row">
              <input id="adminRef" class="input" type="text" placeholder="Reference e.g. EP_..." />
              <button id="btnAdminReconcile" class="btn" type="button">Reconcile</button>
              <button id="btnAdminClear" class="btn ghost" type="button">Exit Admin</button>
            </div>

            <div id="paymentHistory" class="admin-box" hidden>
              <div class="admin-title">Payment History</div>
              <div id="paymentHistoryList" class="mono small">No payments yet.</div>
            </div>

            <!-- âœ… Refund mini UI -->
            <div class="admin-row">
              <input id="refundAmount" class="input" type="number" min="0" step="1" placeholder="Amount (kobo) optional" />
              <input id="refundNote" class="input" type="text" placeholder="Merchant note (optional)" />
              <button id="btnAdminRefund" class="btn ghost" type="button">Refund</button>
            </div>

            <!-- âœ… Audit logs mini UI -->
            <div class="admin-row">
              <input id="auditLimit" class="input" type="number" min="1" max="50" step="1" value="20" />
              <button id="btnAdminAudit" class="btn ghost" type="button">View Audit Logs</button>
              <button id="btnAdminAuditClear" class="btn ghost" type="button">Clear</button>
            </div>

            <div id="auditBox" class="admin-logs" hidden></div>
          </div>

          <div id="payMsg" class="hint"></div>
        </div>
      </div>
    </section>

    <section class="card">
      <div class="row space">
        <div>
          <h2 class="h2-tight">ðŸ“˜ Practice Questions</h2>
          <div id="practiceMeta" class="hint">NECO â€¢ Mathematics â€¢ 2023</div>
        </div>

        <div class="row" style="gap:10px; flex-wrap:wrap; align-items:center;">
          <button id="btnPractice" class="btn" type="button">Start Practice</button>

          <select id="mode">
            <option value="objective">Objective</option>
            <option value="theory">Theory</option>
          </select>

          <!-- Offset + Load removed: paging is automatic -->
        </div>
      </div>

      <div class="pager" id="listPager">
        <button id="btnPrevPage" class="btn ghost" type="button">â—€ Prev Page</button>
        <div class="pager-meta">
          <span id="pageLabel">Page 1</span>
          <span id="pageHint" class="hint"></span>
        </div>
        <button id="btnNextPage" class="btn ghost" type="button">Next Page â–¶</button>
        <div id="paywall" class="paywall">
           <div class="paywall-title">Free preview limit reached</div>
           <div class="paywall-text">Please upgrade to continue browsing.</div>
        </div>
      </div>

      <details id="filtersPanel" class="filters-panel">
        <summary>Filters</summary>
        <div class="filters-row" style="margin-top:10px;">
          <label for="examFilter">Exam</label>
          <select id="examFilter"></select>

          <label for="yearFilter">Year</label>
          <select id="yearFilter"></select>

          <label for="subjectFilter">Subject</label>
          <select id="subjectFilter"></select>

          <button id="btnClearFilters" class="btn ghost" type="button">Clear Filters</button>
        </div>
      </details>

      <div id="startGate" class="gate" hidden>
        <div class="gate-title">Choose your exam to start</div>
        <div class="gate-sub">
          Select <b>Exam</b>, <b>Year</b>, and <b>Subject</b> in the Filters above â€” questions will load automatically.
        </div>
      </div>

      <div id="list" class="list"></div>
      
    </section>

    <section id="viewer" class="card" hidden>
      <div class="row space">
        <h2 id="qTitle">Question</h2>
        <button id="btnClose" class="btn ghost">Close</button>
      </div>

      <div id="qMeta" class="meta"></div>
      <div id="qText" class="qtext"></div>
      <div id="qDiagrams" class="diagrams"></div>
      <div id="qSubQuestions" class="subqs" hidden></div>
      <div id="qOptions" class="options"></div>

      <div class="divider"></div>

      <div id="viewerActions" class="viewer-actions">
        <button id="btnPrev" class="btn ghost" type="button">â—€ Prev</button>
        <button id="btnNext" class="btn ghost" type="button">Next â–¶</button>

        <div class="viewer-actions-spacer"></div>

        <button id="btnReveal" class="btn" type="button">Reveal Answer</button>
        <button id="btnExplain" class="btn ghost" type="button">Show Explanation / Steps</button>
      </div>

      <div id="qExplain" class="explain" hidden></div>
    </section>

    <footer class="footer">
      <div>Â© <span id="yr"></span> ExamPartner MVP â€¢ Built to ship fast.</div>
    </footer>
  </main>

  <script src="https://js.paystack.co/v1/inline.js"></script>
  <script src="app.js?v=20"></script>
</body>
</html>
